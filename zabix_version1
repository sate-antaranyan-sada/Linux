services:
  mysql:
    image: mysql:8.0-oracle
    container_name: mysql-server
    restart: unless-stopped
    ports: 
      - 3306:3306
    command: '--default-authentication-plugin=mysql_native_password'
    environment:
      - MYSQL_DATABASE=zabbix
      - MYSQL_USER=zabbix
      - MYSQL_PASSWORD=zabbix_pwd
      - MYSQL_ROOT_PASSWORD=root_pwd
  
  java:
    image: zabbix/zabbix-java-gateway:7.0-ubuntu-latest
    container_name: zabbix-java-gateway
    restart: unless-stopped
    ports:
      - 10052:10052
    depends_on:
      - mysql

  zabbix:
    image: zabbix/zabbix-server-mysql:7.0-ubuntu-latest
    container_name: zabbix-server-mysql
    restart: unless-stopped
    ports:
      - 10051:10051
    environment:
      - DB_SERVER_HOST=mysql-server
      - MYSQL_DATABASE=zabbix
      - MYSQL_USER=zabbix
      - MYSQL_PASSWORD=zabbix_pwd
      - MYSQL_ROOT_PASSWORD=root_pwd
      - ZBX_JAVAGATEWAY=zabbix-java-gateway
    depends_on:
      - java

  nginx:
    image: zabbix/zabbix-web-nginx-mysql:7.0-ubuntu-latest
    container_name: zabbix-web-nginx-mysql
    ports: 
      - 80:8080
    restart: unless-stopped
    environment:
      - ZBX_SERVER_HOST=zabbix-server-mysql
      - DB_SERVER_HOST=mysql-server
      - MYSQL_DATABASE=zabbix
      - MYSQL_USER=zabbix
      - MYSQL_PASSWORD=zabbix_pwd
      - MYSQL_ROOT_PASSWORD=root_pwd
    depends_on:
      - zabbix